<!-- navbar.component.html -->
<section class="flex items-center h-14 sm:h-16 md:h-full relative md:px-6">
  <!-- LEFT (logo) -->
  <div class="flex items-center gap-2 min-w-0">
    <img
      src="logo.png"
      class="w-10 h-10 sm:w-14 sm:h-14 md:w-20 md:h-20"
      alt=""
    />
    <!-- hide text on mobile -->
    <h1
      class="hidden md:block text-text-heading text-lg sm:text-xl md:text-3xl font-bold -ml-2 tracking-widest"
    >
      ECHOLINK
    </h1>
  </div>

  <!-- CENTER (search) -->
  <!-- desktop/tablet search bar -->
  <div class="hidden md:flex flex-1 justify-center px-4">
    <form class="w-full max-w-[42rem]" (ngSubmit)="searchUser()">
      <input
        type="text"
        [(ngModel)]="searchedUsername"
        placeholder="Search users or groups"
        name="search"
        class="w-full h-10 rounded-2xl bg-input-bg border border-input-border text-text-body placeholder:text-input-placeholder px-4 outline-none hover:border-input-hoverBorder focus:border-input-focusBorder focus:ring-1 focus:ring-border-focus transition duration-150 ease-out"
      />
    </form>
  </div>

  <!-- RIGHT (icons + avatar) -->
  <div class="flex items-center gap-2 md:gap-6 ml-auto">
    <!-- MOBILE search trigger -->
    <button
      type="button"
      class="md:hidden p-2 rounded-xl hover:bg-bg-hover transition text-white"
      (click)="mobileSearchOpen = true"
      aria-label="Open search"
    >
      <lucide-icon
        name="search"
        class="w-5 h-5 sm:w-6 sm:h-6 md:w-7 md:h-7"
      ></lucide-icon>
    </button>

    <a href="/chat" class="p-2 md:px-7 rounded-xl hover:bg-bg-hover transition">
      <lucide-icon
        name="home"
        class="w-5 h-5 sm:w-6 sm:h-6 md:w-7 md:h-7 text-white"
      ></lucide-icon>
    </a>

    <a href="" class="p-2 md:px-7 rounded-xl hover:bg-bg-hover transition">
      <lucide-icon
        name="bell"
        class="w-5 h-5 sm:w-6 sm:h-6 md:w-7 md:h-7 text-white"
      ></lucide-icon>
    </a>

    <a href="" class="p-2 md:px-7 rounded-xl hover:bg-bg-hover transition">
      <lucide-icon
        name="settings"
        class="w-5 h-5 sm:w-6 sm:h-6 md:w-7 md:h-7 text-white"
      ></lucide-icon>
    </a>

    <!-- avatar dropdown (same logic, just responsive sizing/spacing) -->
    <div class="relative">
      <button
        class="relative cursor-pointer rounded-xl hover:bg-bg-hover px-2 py-1 transition"
        (click)="toggleShowProfileDropDown($event)"
      >
        <img
          [src]="me?.avatar"
          class="h-10 w-10 sm:h-12 sm:w-12 md:h-14 md:w-14 rounded-lg"
        />

        <div
          class="w-5 h-5 absolute bg-black rounded-full flex items-center justify-center top-9 md:top-11 right-1"
        >
          <lucide-icon
            name="chevron-down"
            class="text-white w-4 h-4 md:w-5 md:h-5"
          ></lucide-icon>
        </div>
      </button>

      <article
        *ngIf="showProfileDropDown"
        (click)="$event.stopPropagation()"
        class="bg-bg-overlay absolute right-0 md:left-8 top-14 md:top-15 border border-border-base rounded-xl shadow-echo-md w-56 py-3 text-text-body text-sm z-50"
      >
        <div
          class="flex items-center gap-3 px-4 py-2 border-b border-border-base"
        >
          <img
            [src]="me?.avatar"
            class="h-12 w-12 rounded-lg border border-border-base"
          />
          <div class="min-w-0">
            <h2 class="font-semibold text-lg text-text-heading truncate">
              {{ username }}
            </h2>
          </div>
        </div>

        <div class="pt-2 profile-dropdown-container">
          <button
            class="flex items-center gap-3 w-full px-4 py-2 hover:bg-bg-hover transition text-left"
            [routerLink]="'/profile'"
            (click)="
              $event.stopPropagation(); toggleShowProfileDropDown($event)
            "
          >
            <lucide-icon
              name="id-card"
              class="w-4 h-4 text-text-secondary"
            ></lucide-icon>
            My Profile
          </button>

          <button
            class="flex items-center gap-3 w-full px-4 py-2 hover:bg-bg-hover transition text-left"
            [routerLink]="'/people'"
            (click)="
              $event.stopPropagation(); toggleShowProfileDropDown($event)
            "
          >
            <lucide-icon
              name="users"
              class="w-4 h-4 text-text-secondary"
            ></lucide-icon>
            People & Requests
          </button>

          <button
            class="flex items-center gap-3 w-full px-4 py-2 hover:bg-bg-hover transition text-left"
            (click)="
              $event.stopPropagation(); toggleShowProfileDropDown($event)
            "
          >
            <lucide-icon
              name="shield-alert"
              class="w-4 h-4 text-text-secondary"
            ></lucide-icon>
            Message Privacy
          </button>

          <button
            class="flex items-center gap-3 w-full px-4 py-2 hover:bg-bg-hover transition text-left text-red-400"
            (click)="
              $event.stopPropagation();
              toggleShowProfileDropDown($event);
              showLogoutModal = true
            "
          >
            <lucide-icon name="log-out" class="w-4 h-4"></lucide-icon>
            Log Out
          </button>
        </div>
      </article>
    </div>
  </div>

  <div
    *ngIf="showLogoutModal"
    class="fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm"
  >
    <!-- Modal -->
    <div
      class="w-[90%] max-w-sm rounded-2xl bg-bg-panel border border-border-base shadow-echo-xl p-6 animate-scale-in"
    >
      <!-- Title -->
      <h2 class="text-lg font-semibold text-text-heading mb-2">Log out?</h2>

      <!-- Message -->
      <p class="text-sm text-text-muted mb-6">
        Are you sure you want to log out of your EchoLink account?
      </p>

      <!-- Actions -->
      <div class="flex justify-end gap-3">
        <button
          type="button"
          class="px-4 py-2 rounded-xl border border-border-base text-text-muted hover:text-text-body hover:bg-bg-hover transition"
          (click)="showLogoutModal = false"
        >
          Cancel
        </button>

        <button
          type="button"
          class="px-4 py-2 rounded-xl bg-red-500/90 text-white hover:bg-red-600 shadow-echo-md transition"
          (click)="logout()"
        >
          Log out
        </button>
      </div>
    </div>
  </div>

  <!-- MOBILE SEARCH OVERLAY (premium, clean) -->
  <div *ngIf="mobileSearchOpen" class="fixed inset-0 z-50 md:hidden">
    <div
      class="absolute inset-0 bg-bg-base/80 backdrop-blur-sm"
      (click)="mobileSearchOpen = false"
    ></div>

    <div class="absolute left-0 right-0 top-0 p-3">
      <div
        class="bg-bg-panel border border-border-base rounded-2xl shadow-echo-md p-3 flex items-center gap-2"
      >
        <lucide-icon
          name="search"
          class="w-5 h-5 text-text-muted"
        ></lucide-icon>

        <form
          class="flex-1"
          (ngSubmit)="searchUser(); mobileSearchOpen = false"
        >
          <input
            type="text"
            [(ngModel)]="searchedUsername"
            placeholder="Search users or groups"
            name="search"
            autofocus
            class="w-full h-10 rounded-2xl bg-input-bg border border-input-border text-text-body placeholder:text-input-placeholder px-4 outline-none hover:border-input-hoverBorder focus:border-input-focusBorder focus:ring-1 focus:ring-border-focus transition duration-150 ease-out"
          />
        </form>

        <button
          type="button"
          class="p-2 rounded-xl hover:bg-bg-hover transition text-text-muted"
          (click)="mobileSearchOpen = false"
          aria-label="Close search"
        >
          ✕
        </button>
      </div>
    </div>
  </div>

  <!-- your existing searchedResult modal stays the same -->
  <div
    *ngIf="searchedResult"
    class="fixed inset-0 bg-bg-base/80 backdrop-blur-sm flex items-center justify-center z-40"
  >
    <div
      class="bg-bg-overlay border border-border-base rounded-2xl shadow-echo-md w-[30rem] max-w-[92vw] px-6 py-5 flex flex-col gap-5"
    >
      <div class="flex justify-between items-center">
        <h2 class="text-text-heading font-semibold text-lg tracking-wide">
          User Found
        </h2>
        <button
          (click)="closeModal()"
          class="text-text-muted hover:text-text-body text-xl"
        >
          ✕
        </button>
      </div>

      <div
        class="flex items-center gap-4 p-4 bg-bg-panel rounded-xl border border-border-base"
      >
        <img
          [src]="
            'https://api.dicebear.com/9.x/adventurer/svg?seed=' +
            searchedResult.username
          "
          class="h-14 w-14 rounded-xl border border-border-base"
        />

        <div class="flex flex-col min-w-0">
          <span class="text-text-heading font-semibold text-base truncate">
            {{ searchedResult.username }}
          </span>

          <span class="text-text-muted text-xs">
            Joined {{ searchedResult.joinedAt ? null : "2025, May 25" }}
          </span>
        </div>
      </div>

      <div class="flex justify-end gap-3">
        <button
          (click)="searchedResult = null"
          class="px-5 py-1.5 border border-border-base text-text-secondary text-sm rounded-lg hover:bg-bg-hover transition"
        >
          Close
        </button>

        <button
          (click)="openChat()"
          class="px-5 py-1.5 bg-brand-active text-text-onAccent text-sm rounded-lg hover:bg-brand-hover transition"
        >
          Message
        </button>
      </div>
    </div>
  </div>
</section>
