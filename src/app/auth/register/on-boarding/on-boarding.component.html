<div
  class="min-h-screen w-full bg-bg-base flex items-center justify-center px-6"
>
  <div
    class="w-full max-w-5xl rounded-2xl border border-border-base bg-bg-panel shadow-echo-md overflow-hidden grid grid-cols-1 md:grid-cols-2"
  >
    <!-- LEFT -->
    <div class="relative p-10 flex flex-col justify-center gap-6 bg-bg-panel">
      <div>
        <h1 class="text-3xl font-semibold text-text-heading leading-tight">
          Finish <br />
          your profile
        </h1>

        <p class="mt-4 text-text-secondary text-sm max-w-sm">
          Choose a username and an avatar. You can change it later.
        </p>
      </div>

      <div class="mt-10">
        <div
          class="h-12 w-12 rounded-2xl bg-brand/10 border border-border-base flex items-center justify-center shadow-echo"
        >
          <div class="h-6 w-6 rounded-md bg-brand"></div>
        </div>
      </div>
    </div>

    <!-- RIGHT -->
    <div class="p-10 flex items-center">
      <form [formGroup]="form" (ngSubmit)="onSubmit()" class="w-full space-y-6">
        <!-- Email (read-only) -->
        <div class="space-y-1">
          <label class="text-sm text-text-secondary"> Email </label>
          <input
            [value]="email"
            disabled
            class="w-full h-11 rounded-lg bg-bg-overlay text-text-muted px-4 border border-border-base outline-none"
          />
        </div>

        <!-- Preview -->
        <div
          class="flex items-center gap-4 rounded-xl border border-border-base bg-bg-elevated px-4 py-3"
        >
          <div
            class="h-14 w-14 rounded-full overflow-hidden border border-border-base bg-bg-hover flex items-center justify-center"
          >
            <img
              *ngIf="selectedAvatarUrl"
              [src]="selectedAvatarUrl"
              class="h-full w-full object-cover"
              alt="Avatar preview"
            />
            <div
              *ngIf="!selectedAvatarUrl"
              class="h-6 w-6 rounded-md bg-brand/40"
            ></div>
          </div>

          <div class="min-w-0">
            <p class="text-sm text-text-muted">Preview</p>
            <p class="text-text-body font-medium truncate">
              {{ form.value.username || "your_username" }}
            </p>
          </div>
        </div>

        <!-- Username -->
        <div class="space-y-1">
          <label class="text-sm text-text-secondary"> Username </label>
          <input
            type="text"
            formControlName="username"
            placeholder="Choose a username"
            class="w-full h-11 rounded-lg bg-input-bg text-input-text placeholder:text-input-placeholder px-4 border border-input-border hover:border-input-hoverBorder focus:border-input-focusBorder focus:ring-1 focus:ring-border-focus outline-none transition"
          />

          <p
            *ngIf="
              form.get('username')?.touched && form.get('username')?.invalid
            "
            class="text-sm text-text-danger"
          >
            Username is required (3â€“20 chars).
          </p>
        </div>
        <div class="space-y-1">
          <div class="flex items-center justify-between">
            <label class="text-sm text-text-secondary"> Bio (optional) </label>
            <span class="text-xs text-text-muted">
              {{ form.get("bio")?.value?.length || 0 }}/160
            </span>
          </div>

          <textarea
            formControlName="bio"
            rows="3"
            placeholder="Tell people a little about yourself..."
            class="w-full resize-none rounded-lg bg-input-bg text-input-text placeholder:text-input-placeholder px-4 py-3 border border-input-border hover:border-input-hoverBorder focus:border-input-focusBorder focus:ring-1 focus:ring-border-focus outline-none transition"
          ></textarea>

          <p
            *ngIf="form.get('bio')?.touched && form.get('bio')?.invalid"
            class="text-sm text-text-danger"
          >
            Bio must be 160 characters or less.
          </p>
        </div>

        <!-- Avatar picker -->
        <div class="space-y-3">
          <div class="flex items-center justify-between">
            <label class="text-sm text-text-secondary">
              Choose an avatar
            </label>
            <button
              type="button"
              (click)="randomizeAvatar()"
              class="text-sm text-link hover:text-link-hover transition font-medium"
            >
              Randomize
            </button>
          </div>

          <div class="max-h-[260px] overflow-y-auto pr-2 flex flex-col gap-5">
            <div *ngFor="let group of avatarGroups" class="flex flex-col gap-3">
              <h4
                class="text-text-secondary font-semibold text-sm tracking-wide"
              >
                {{ group.label }}
              </h4>

              <div class="grid grid-cols-5 gap-3">
                <button
                  type="button"
                  *ngFor="let seed of group.seeds"
                  (click)="selectAvatar(group.style, seed)"
                  class="rounded-xl p-2 border transition"
                  [ngClass]="{
                    'border-brand-active bg-bg-hover shadow-echo':
                      selectedKey === group.style + ':' + seed,
                    'border-border-base hover:bg-bg-hover':
                      selectedKey !== group.style + ':' + seed
                  }"
                >
                  <img
                    [src]="getAvatarUrl(group.style, seed)"
                    class="h-12 w-12 rounded-lg bg-bg-overlay"
                    alt="Avatar"
                  />
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- API error -->
        <p *ngIf="apiError" class="text-sm text-text-danger">
          {{ apiError }}
        </p>

        <!-- Submit -->
        <button
          type="submit"
          [disabled]="loading || !selectedAvatarUrl"
          class="w-full h-11 rounded-lg bg-button-primary-bg text-button-primary-text hover:bg-button-primary-hover active:bg-button-primary-active transition font-medium disabled:opacity-60 disabled:cursor-not-allowed"
        >
          {{ loading ? "Saving..." : "Continue" }}
        </button>
      </form>
    </div>
  </div>
</div>
